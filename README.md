# run_green_cubo.sbatch
**Использование.**
Запуск осуществляется командой `sbatch run_green_cubo.sbatch`. Это обычный скрипт для одновременного запуска нескольких задач с общими параметрами для SLURM (запуск в режиме массива). Для работы скрипта требуется начальная директория с необходимыми для запуска МД расчетов файлами. Скрипт копирует эту директорию нужное количество раз и для каждой из них ставит в очередь на выполнение заданную последовательность команд для моделирования.

**Настройка поведения.**
*	Входная директория задается в скрипте переменной `INIT_DIR` (по умолчанию директория `init` в той же директории, где и сам скрипт);
*	Количество копий задается в скрипте как SBATCH переменная `--array=N-M` (N – начальный индекс задачи, М – конечный индекс задачи);
*	Имя директорий для запускаемых задач состоит из двух частей: имени – задается в скрипте переменной `WORK_DIR` (по умолчанию `traj_`) и индекса – берется из значений переменной `--array` (см. выше);
*	Желаемое количество CPU, GPU и иных ресурсов задается обычным для SBATCH скриптов способом. Указываемое количество ресурсов – это количество, запрашиваемое на одну задачу;
*	Последовательность команд для выполнения перечислена в конце скрипта.

Результатом успешного выполнения скрипта будут (M-N) директорий с данными расчетов. 

# viscosity.py
**Использование.**
Для запуска необходим интерпретатор Python 3 (использовалась версия 3.8) и установленные библиотеки NumPy (при написании использовалась версия 1.21.5) и SciPy (при написании использовалась версия 1.7.3). Данный скрипт вычисляет из набора автокорреляционных функций компонентов тензора давления значение вязкости по алгоритму из статьи [^Zhang2015]. Для корректной работы иерархическая структура входных данных должна быть сформирована скриптом `run_green_cubo.sbatch` или аналогичным ему. 

`viscosity.py [-h] [--fraction FRACTION] [--amount AMOUNT] [--oa AVE_NAME] [--os STD_NAME] [--of FIT_NAME] [directory] [stem]`
* `directory` — Имя директории с директориями расчетов. По умолчанию это текущая директория;
* `stem`  — Общая часть имени для директорий с результатами расчетов. По умолчанию это `traj_`;

**Параметры:**
* `--fraction N` — Отношение величины STD вязкости к её среднему значению для расчета t<sub>cut</sub>. По умолчанию 0.4;
*	`--amount AMOUNT` — Количество директорий с результатами расчетов для обработки. Если значение больше 0 или превышает количество доступных директорий, берутся все доступные директории. По умолчанию 0;
* `--oa AVE_NAME` — Имя файла для сохранения усредненной зависимости вязкости от времени моделирования [пс], [П]. Если не задана, данные сохраняться не будут;
*	`--os STD_NAME` — Имя файла для сохранения величины STD вязкости от времени моделирования [пс], [П]. Если не задана, данные сохраняться не будут;
* `--of FIT_NAME` — Имя файла для сохранения приближенной («отфитированной») зависимости вязкости от времени моделирования [пс], [П]. Если не задана, данные сохраняться не будут;
* `-h`, `--help` — помощь по использованию.

После успешного выполнения скрипт выведет полученное значение вязкости в пуазах [П] и дополнительные параметры и характеристики произведенных приближений.
 
# run_nemd.sbatch
**Использование.**
Запуск осуществляется командой `sbatch run_nemd.sbatch`. Как и скрипт `run_green_cubo.sbatch`, это скрипт для одновременного запуска нескольких задач с общими параметрами для SLURM (запуск в режиме массива). Его отличием является двухэтапный запуск задач, обусловленный алгоритмом расчета сдвиговой вязкости методом пространственно осциллирующих возмущений (spatially oscillating perturbations). На первом этапе проводится N моделирований с одинаковыми параметрами расчета. На втором этапе для каждого из N моделирований проводится M моделирований с различным значением ускорения (параметр `cos-acceleration`), накладываемого на частицы системы [^AllenCSL]. Это достигается созданием отдельных `.sbatch` файлов, которые запускают расчет с каждым значением ускорения. Результатом является N×M значений вязкости, использующиеся для дальнейшей обработки. Для работы скрипта требуется директория с необходимыми файлами для запуска МД расчетов. Скрипт копирует эту директорию нужное количество раз и для каждой из них ставит в очередь на выполнение заданную последовательность команд для моделирования.

**Настройка поведения.**
* Входная директория задается в скрипте переменной `INIT_DIR` (по умолчанию директория `init` в той же директории, где и сам скрипт);
* Количество копий задается в скрипте как SBATCH переменная `--array=N-M` (N – начальный индекс задачи, М – конечный индекс задачи);
*	Имя директорий для запускаемых задач состоит из двух частей: имени – задается в скрипте переменной `WORK_DIR` (по умолчанию `traj_`) и индекса – берется из значений переменной `--array` (см. выше);
* Желаемые значения ускорений перечисляются в переменной `ACCELERATIONS`;
* Имя логин-сервера указывается в `LOGIN_SERVER`. Оно необходимо для выполнения второго этапа расчетов;
* Желаемое количество CPU, GPU и иных ресурсов задается обычным для SBATCH скриптов способом. Указываемое количество ресурсов – это количество, запрашиваемое на одну задачу.

Результатом успешного выполнения скрипта будут (M-N) директорий в каждой из которых будут файлы со значениями вязкости для каждого из заданных ускорений.

[^Zhang2015]: Y. Zhang, A. Otani, E.J. Maginn, Reliable Viscosity Calculation from Equilibrium Molecular Dynamics Simulations: A Time Decomposition Method, J. Chem. Theory Comput. 11 (2015) 3537–3546. https://doi.org/10.1021/acs.jctc.5b00351.

[^AllenCSL]: M.P. Allen, D.J. Tildesley, Computer Simulation of Liquids, (2017). https://doi.org/10.1093/oso/9780198803195.001.0001.

